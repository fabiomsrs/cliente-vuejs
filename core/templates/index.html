{% extends 'base.html' %}
{% block content %}
	
	<div id="app">					
      <div class="container">
        <div class="row">
          <h1>List of Students
          <button class="btn btn-success" data-toggle="modal" data-target="#addStudentModal">ADD STUDENT</button>
          </h1>
          <table class="table">
            <thead>
              <tr>
                <th scope="col">#</th>
                <th scope="col">Heading</th>
                <th scope="col">Action</th>
              </tr>
            </thead>
            <tbody>
              <tr v-for="student in students">
                <th scope="row">[[student.pk]]</th>
                <td>[[student.name]]</td>
                <td>                  
                  <button class="btn btn-danger" v-on:click="deleteStudent(student.pk)">Delete</button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div class="loading" v-if="loading===true">Loading&#8230;</div>
	
<!-- Add Student Modal -->
          <div class="modal fade" id="addStudentModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
            <div class="modal-dialog" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="exampleModalLongTitle">ADD STUDENT</h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <form v-on:submit.prevent="addStudent()">
                <div class="modal-body">
                    <div class="form-group">
                      <label for="student_name">Student Name</label>
                      <input
                        type="text"
                        class="form-control"
                        id="student_name"
                        placeholder="Enter Student Name"
                        v-model="newStudent.name"
                        required="required"/>
                      <label for="student_name">Student Username</label>
                      <input
                        type="text"
                        class="form-control"
                        id="student_name"
                        placeholder="Enter Student Username"
                        v-model="newStudent.username"
                        required="required"/>

                        <label for="student_email">Student Email</label>
                        <input
                        type="text"
                        class="form-control"
                        id="student_name"
                        placeholder="Enter Student Email"
                        v-model="newStudent.email"
                        required="required" >
                    </div>                    
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                  <button type="submit" class="btn btn-primary">Save changes</button>
                </div>
                </form>
              </div>
            </div>
           <div class="loading" v-if="loading===true">Loading&#8230;</div>          
          </div>
          <!-- End of Student modal -->
		  <p v-if = "message">
	      [[message.status]] / [[message.statusText]]
		  </p>
		  <p v-if = "errors">
	      [[errors.status]] / [[errors.statusText]]
		  </p>
	</div>	

	<script type="text/javascript">
		new Vue({		 
		  delimiters: ["[[","]]"],
		  el: '#app',
		  data: {
		   students: [],
		   loading: false,
		   currentStudent: {},
		   message: '',	
		   errors: '',
		   newStudent: { "username": null, "email": null},	   
        },
        methods: {
			getStudents: function() {
			  this.loading = true;
			  axios.get("http://localhost/students/")
			      .then((response) => {			      	
			      	console.log(response.data.results)
			        this.students = response.data.results;
			        this.loading = false;
			      })
			      .catch(function (error) {
				    // handle error
				    console.log(error);
				  })
			 },
			 getStudent: function(id) {
			  this.loading = true;
			  axios.get("http://localhost/students/"+id+"/")
			      .then((response) => {
			      	console.log(response.data)
			        this.currentStudent = response.data;
			        this.loading = false;
			      })
			      .catch(function (error) {
				    // handle error
				    this.errors = error;
				    this.message = ''
				    console.log(error);
				  })
			 },
			 addStudent: function() {
			  this.loading = true;
			  axios.post("http://localhost/students/", this.newStudent)
			      .then((response) => {
			        this.loading = false;
			        this.message = response;
			        this.getStudents()
			        console.log(this.message)
			      })
			      .catch(function (error) {
				    // handle error
				    console.log(error);
				  })			 
			 },
			 deleteStudent: function(id) {
			  this.loading = true;
			  axios.delete("http://localhost/students/"+id+"/")
			      .then((response) => {
			        this.loading = false;
			        this.getStudents();
			      })
			      .catch(function (error) {
				    // handle error
				    console.log(error);
				  })
			 }	 
		  },
		  mounted: function () {
		    this.getStudents();
		  },
		  
		});
			
	</script>
{% endblock %}